{"version":3,"names":[],"mappings":"","sources":["index.js"],"sourcesContent":["(function($) {\n  // ===========> 数据渲染交互之外的逻辑（环境判断）<===========\n  // 是否是微信\n  function isWeixinBrowser() {\n    var ua = navigator.userAgent.toLowerCase()\n    return /micromessenger/.test(ua)\n  }\n\n  // 加载时判断是否是微信页面\n  function load() {\n    if (isWeixinBrowser) {\n      // 引导用户到浏览器中打开h5\n      // ...\n    }\n  }\n\n  load()\n\n  // 唤醒app 采用urlScheme\n  let openApp = () => {\n    /* eslint-disable no-unused-vars */\n    let urlScheme = 'duomi://'\n    let hasApp = true\n    let timeoutTimer = null\n    let downloadTimer = null\n    let t = 1000\n    let t1 = null\n    let t2 = null\n    /* eslint-enable no-unused-vars */\n\n    downloadTimer = setTimeout(() => {\n      if (!hasApp) {\n        window.location = 'download://'\n      }\n    }, 2000)\n\n    // 记录初始时间\n    t1 = Date.now()\n\n    // 生成iframe(iOS9需要兼容)\n    let ifr = document.createElement('iframe')\n    ifr.setAttribute('style', 'display:none')\n    ifr.setAttribute('src', urlScheme)\n    document.body.appendChild(ifr)\n\n    // timeout\n    timeoutTimer = setTimeout(() => {\n      t2 = Date.now()\n      if (t2 - t1 < t + 300) {\n        hasApp = false\n        // 移除iframe\n        document.body.removeChild(ifr)\n      }\n    }, t)\n  }\n\n  // =============> 前端交互逻辑start <=============\n\n  // 数据请求前显示loading\n  $('.loading').show()\n\n  // 请求文章内容\n  $.ajax({\n    type: 'GET',\n    url: 'https://shiziquan.com/shiziquan/learn?action=articlelist&accountId=1000036&artId=130',\n    dataType: 'json',\n    success: function(res) {\n      $('.wrapper').show()\n      $('.loading').hide()\n      let data = res.data\n      if (data && data.items) {\n        let dataAry = data.items\n        if (dataAry && dataAry.length) {\n          renderArticleInfo(dataAry[0])\n          renderGoodsList(dataAry[0].content)\n          renderRelatedGoods(dataAry[0].numInfos)\n        }\n      } else {\n        alert('文章不存在,请刷新重试')\n      }\n    },\n    error: function(xhr, type) {\n      alert('服务器繁忙!')\n      $('.loading').hide()\n    }\n  })\n\n  // 渲染文章相关信息\n  function renderArticleInfo(data) {\n    let createTime = data.createTime\n    let title = data.title\n    let descTitle = data.desc_title\n    let headerBg = data.pict_url\n    let artSource = data.artSource\n    $('.label').text(artSource)\n    $('.content-source .date').text(createTime)\n    $('.header-bg').attr('src', headerBg)\n    $('.content-title span').text(title)\n    $('.content-desc p').text(descTitle)\n  }\n\n  // 渲染商品列表\n  function renderGoodsList(data) {\n    $('.rich-text-editor').html(data)\n    $('.commodityCard #purchase').click(() => {\n      dialogShow()\n    })\n  }\n\n  // 显示dialog\n  function dialogShow () {\n    $('.dialog-modal').show()\n  }\n\n  // 关闭dialog\n  $('.modal-content--btn').click(() => {\n    $('.dialog-modal').hide()\n  })\n\n  // 渲染相关商品\n  function renderRelatedGoods(data) {\n    let htmlAry = []\n    let goodsLength = data.length\n    // 相关商品 >= 1\n    if (goodsLength) {\n      for (let i = 0; i <= data.length; i++) {\n        let cur = data[i]\n        if (cur) {\n          let str = `\n          <li>\n            <a class=\"relatedGoods\">\n              <div class=\"left\"><img src=\"${cur.pict_url}\"></div>\n              <div class=\"right\">\n                <div class=\"product-title\">${cur.title}</div>\n                <div class=\"bottom\">\n                  <div class=\"price\">￥29.8</div>\n                  <div class=\"btn\">去购买</div>\n                </div>\n              </div>\n            </a>\n          </li>\n          `\n          htmlAry.push(str)\n\n          // 当相关商品大于1时渲染actionSheet\n          if (data.length > 1) {\n            renderActionSheet(data)\n          }\n        }\n      }\n      $('.related-goods').append(htmlAry.join(''))\n\n      // 点击相关商品购买显示dialog\n      $('.related-goods li .btn').click(() => {\n        dialogShow()\n      })\n\n      // 底部显示 直达链接 | 返利模式购买 按钮\n      let str = `\n      <a href=\"javascript:void(0)\" class=\"through-link\">直达链接</a>\n      <a href=\"javascript:void(0)\" class=\"rebate\">返利模式购买</a>\n      `\n\n      $('.bottom-btns-container .btns').append(str)\n\n      // 初始化dom变量\n      let $througnLink = $('.through-link')\n      let $rebate = $('.rebate')\n\n      // 如果商品数量大于1\n      if (goodsLength > 1) {\n        $througnLink.click((e) => {\n          actionSheetShow(e)\n        })\n\n        // 跳转到下载链接\n        $rebate.click(() => {\n          window.location = ''\n        })\n      } else if (goodsLength === 1) {\n        $througnLink.click((e) => {\n          dialogShow()\n          // actionSheetShow(e)\n        })\n\n        // 跳转到下载链接\n        $rebate.click(() => {\n          window.location = ''\n        })\n      }\n    } else { // 相关商品数量为0\n      $('.related-products').hide()\n\n      // 显示按钮：打开APP看更多爆料文章\n      let str = `<a href=\"javascript:void(0)\" class=\"view-more-detail\">打开APP看更多爆料文章</a>`\n      $('.bottom-btns-container .btns').append(str)\n      $('.activity-desc').css('marginBottom', '.8rem')\n      // 点击按钮跳转到下载链接\n    }\n  }\n\n  // 渲染actionSheet列表\n  function renderActionSheet(goods) {\n    let htmlAry = []\n    for (let i = 0; i < goods.length; i++) {\n      let cur = goods[i]\n      let str = `\n      <li>\n        <p class=\"title\">${cur.title}</p>\n        <a class=\"btn\" data-link=\"${cur.click_url}\">直达链接</a>\n      </li>\n      `\n      htmlAry.push(str)\n    }\n    $('.action-sheet--list').append(htmlAry.join(''))\n\n    // 隐藏actionsheet, 显示弹框\n    $('.action-sheet--list li .btn').click((e) => {\n      actionSheetHide(e)\n      dialogShow()\n    })\n  }\n\n  function actionSheetShow(e) {\n    $('.action-sheet-modal').show()\n    $('.action-sheet').addClass('up')\n    e.stopPropagation()\n  }\n\n  function actionSheetHide(e) {\n    $('.action-sheet-modal').hide()\n    $('.action-sheet').removeClass('up')\n    e.stopPropagation()\n  }\n\n  $('.action-sheet').click((e) => {\n    e.stopPropagation()\n  })\n\n  $(document).click(() => {\n    $('.action-sheet-modal').hide()\n    $('.action-sheet').removeClass('up')\n  })\n})(Zepto)\n"],"file":"../js/index.js"}